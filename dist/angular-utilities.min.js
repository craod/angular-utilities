!function(){"use strict";angular.module("angular-utilities",[])}(),function(){"use strict";function a(a){return{restrict:"E",scope:{object:"=",width:"@?",height:"@?",mode:"@?","class":"@?",type:"@?"},templateUrl:"templates/objectimage.html",link:function(b){b.resource=a}}}a.$inject=["Resource"],angular.module("angular-utilities").directive("objectImage",a)}(),function(){"use strict";function a(a){return{restrict:"A",scope:{object:"=",format:"@?",property:"@?",type:"@renderObject"},template:'<i data-ng-if="loading" class="fa fa-refresh fa-spin"></i> {{loading ? "" : (format ? (format | translate:entity) : entity[property])}}',link:function(b){if(b.object&&"object"==typeof b.object)b.entity=b.object;else{b.loading=!0;var c=b.type[0].toUpperCase()+b.type.substring(1)+"Service",d=a.get(c),e=d.get({},{guid:b.object});e.then(function(a){b.entity=a}),e["finally"](function(){delete b.loading})}}}}a.$inject=["$injector"],angular.module("angular-utilities").directive("renderObject",a)}(),function(){"use strict";function a(a,b,c){function d(a,b){b.sortBy&&(a.sortBy=b.sortBy,b.order&&(a.order=b.order))}function e(a,b){b.offset&&(a.offset=b.offset),b.limit&&(a.limit=b.limit)}function f(a,b){var c,d;if(b.filters)for(c in b.filters)d="filters["+c+"]",a[d]=b.filters[c]}function g(b,c){var d,e,f=document.createElement("a");for(d in c)e=new RegExp(":"+d,"g"),b.match(e)&&(b=b.replace(e,c[d]),delete c[d]);return f.href=a.get("api.url"),f.origin+b}function h(a){var b,c,d=a;if(arguments.length>1)for(c=1;c<arguments.length;c++)for(b in arguments[c])d+="_"+b+":"+arguments[c][b];return d}function i(a,i,j){m.services[a][i]=function(k,m){m=m||{},k=k||{};var n,o,p,q={},r=m.force;if(o=j.method?j.method:"get",j.paginatable&&e(q,m),j.sortable&&d(q,m),j.filterable&&m.filters&&f(q,m),n=h(i,q,k),p=g(j.route,k),!l[a]||!l[a][n]||!j.cachable||r){var s=c({method:o,url:p,params:q,data:k}),t=b.defer();s.then(function(a){var b={};b=j.paginatable?{items:a.data.items,pagination:{offset:a.data.offset,limit:a.data.limit,total:a.data.total}}:a.data,t.resolve(b)},t.reject),l[a]||(l[a]={}),l[a][n]=t.promise}return l[a][n]},m.services[a][i].clearCache=function(){var b;if(l.hasOwnProperty(a))for(b in l[a])if(0===b.indexOf(action))return delete l[a][b],!0;return!1}}function j(a){var b,c,d;for(b in a){m.services[b]={};for(c in a[b])d=a[b][c],i(b,c,d);m.services[b].clearCaches=function(){l[b]={}}}}var k,l={},m={services:{},load:function(){if(!k){var d=b.defer(),e=c({method:"get",url:a.get("api.url")+"schema/endpoints"});e.then(function(a){j(a.data),d.resolve()},d.reject),k=d.promise}return k}};return m}a.$inject=["Settings","$q","$http"],angular.module("angular-utilities").service("Api",a)}(),function(){"use strict";function a(){function a(a){var c={};return c.data=angular.copy(b.data),c.isLoaded=function(){return!!c.initialized},c.load=function(){var d=a.get(b.endpoint);return c.initialized=!1,d.then(function(a){c.data=angular.extend(a.data,b.data)}),d["finally"](function(){c.initialized=!0}),d},c.settingExists=function(a){var b,d,e=a.split("."),f=angular.copy(c.data);for(b in e){if(d=e[b],!f.hasOwnProperty(d))return!1;f=f[d]}return!0},c.get=function(a,b){var d,e,f=a.split("."),g=angular.copy(c.data);for(d in f){if(e=f[d],!g.hasOwnProperty(e))return b;g=g[e]}return g},c}var b=this;b.data={},b.endpoint="",a.$inject=["$http"],b.$get=a}angular.module("angular-utilities").provider("Settings",a)}(),function(){"use strict";function a(a){var b={};return b.getExtensionByMimeType=function(a){var b=a.toLowerCase().split("/")[1];return"jpeg"==b&&(b="jpg"),b},b.getApproximateSize=function(a,b,c){var d,e,f,g,h,i,j;for(d in c)"watermarked"!=c[d]&&(g=c[d].split("-")[0].split("x"),e=g[0],f=g[1],h=Math.abs(a-e)+Math.abs(b-f),(void 0===i||i>h)&&(i=h,j=c[d]));return j},b.getPublicUrl=function(b){return a.get("storage.location")+"/"+b},b.getProfilePictureUrl=function(a,c,d){return a&&a.profilePicture?a.profilePicture.sizes&&c&&d?b.getPublicUrl("user/"+a.guid+"-"+b.getApproximateSize(c,d,a.profilePicture.sizes)+".png"):a.profilePicture.original:b.getPublicUrl("user/anonymous.png")},b.getImageUrl=function(a,c,d){if(a&&a.fileInformation){var e=b.getExtensionByMimeType(a.mimeType);return a.fileInformation.sizes&&c&&d?b.getPublicUrl("image/"+a.guid+"-"+b.getApproximateSize(c,d,a.fileInformation.sizes)+"."+e):a.fileInformation.original}throw new Error("Entity contains no image information: "+a.guid)},b}a.$inject=["Settings"],angular.module("angular-utilities").service("Resource",a)}(),angular.module("angular-utilities").run(["$templateCache",function(a){"use strict";a.put("templates/objectimage.html",'<img data-ng-src="{{type == \'user\' ? resource.getProfilePictureUrl(object, width, height) : resource.getImageUrl(object, width, height)}}"\r\n     data-ng-attr-height="{{height}}"\r\n     data-ng-attr-width="{{width}}"\r\n'+"     class=\"{{type == 'user' ? 'profile-picture' : 'object-image'}} {{class}}\" />")}]);